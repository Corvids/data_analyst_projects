White and Red Wine Quality by Jennifer Joo
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

# install.packages("ggplot2", dependencies = T) 
# install.packages("knitr", dependencies = T)
# install.packages("dplyr", dependencies = T)
 
library(ggplot2)
library(knitr)
library(dplyr)
library(corrplot)

```

```{r global_options, include=FALSE}
# prevent warnings from showing in knitted file
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, Load_the_Data}
# data source: http://archive.ics.uci.edu/ml/datasets/Wine+Quality

# Load the Data
red <- read.csv("winequality-red.csv", sep = ";")
red$type <- 'red'
white <- read.csv("winequality-white.csv", sep = ";")
white$type <- 'white'

data <- rbind(red, white)

str(data)
summary(data)

```

```{r echo=FALSE, Multiplot}
# source: http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}

plot1 <- ggplot(data, aes(x=quality)) +
          geom_bar(colour="#333333", fill="#6666FF") +
          ggtitle("Quality Histogram")

plot2 <- ggplot(data, aes(x=alcohol)) +
          geom_bar(colour="#333333", fill="#3399FF") +
          ggtitle("Alcohol Histogram")

plot3 <- ggplot(data, aes(x=sulphates)) +
          geom_bar(colour="#333333", fill="#33FF99") +
          ggtitle("Sulphates Histogram")

plot4 <- ggplot(data, aes(x=pH)) +
          geom_bar(colour="#333333", fill="#CC3333") +
          ggtitle("pH Histogram")
multiplot(plot1, plot2, plot3, plot4)

```

# Univariate Analysis

### What is the structure of your dataset?

There are 6,497 observations and 13 variables.

### What is/are the main feature(s) of interest in your dataset?

The main features of interest are quality, which is a score between 0 and 10, and type, a created variable that indicates whether the wine is red or white.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Without looking further at the data set, I think that pH, quality, and alcohol may be important.

### Did you create any new variables from existing variables in the dataset?

Yes, I merge the red wine and white wine datasets and created the variable "type" to indicate which dataset the observations came from.  The possible values are "red" and "white".

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

The distribution for chlorides showed a right skew.


# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}
# box plot -- quality by type
plot1 <- ggplot(data, aes(x=type, y=quality, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for Quality by Wine Type")

# box plot -- pH by type
plot2 <- ggplot(data, aes(x=type, y=pH, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for pH by Wine Type")

multiplot(plot1, plot2)

# correlation matrix
# for reference, see:
# https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html
df_corr <- subset( data, select=-c(type) )
mcor <- cor(df_corr)
round(mcor, digits=2)

cex.before <- par("cex")
par(cex = 0.7)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(mcor, method="color",
            shade.col=NA, tl.col="black", tl.srt=45, order="FPC",
            col=col(50), addCoef.col="black", addcolorlabel="yes")
par(cex = cex.before)

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

In the density plot, it appears as though white wines are rated more highly but since there are more white wines, this graph may be misleading.  Looking at the box plot, the majority of each wine (red and white) are rated between a 5 and 6 but white wines have more outliers that are rated more highly.


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?

The strongest relationship was between total.sulfur.dioxide and free.sulfur.dioxide which has a correlation of 0.72.  The next strongest was between density and residual.sugar with a correlation of 0.55.


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

# bar graphs
plot1 <- ggplot(data, aes(x=quality, y=alcohol, fill=type)) +
          geom_bar(stat="identity") +
          ggtitle("Bar Plot for alcohol segmented by quality and wine type")

plot2 <- ggplot(data, aes(x=pH, y=alcohol, fill=type)) +
          geom_bar(stat="identity") +
          ggtitle("Bar Plot for alcohol segmented by pH and wine type")

multiplot(plot1, plot2)

# scatter plots and regression lines
plot1 <- ggplot(data, aes(x=pH, y=quality, color=type)) + geom_point(shape=1) +
          scale_colour_hue(l=75) +
          geom_smooth(method=lm,   # Adds regression lines
          se=FALSE, fullrange=TRUE) # extenda the regression lines

plot2 <- ggplot(data, aes(x=pH, y=alcohol, colour=type)) +
            geom_point(alpha=.3) +
            geom_smooth(alpha=.2, size=1, method='loess')

# bar graphs faceted by quality
plot3 <-  ggplot(data, aes(x=pH, fill=quality)) +
            geom_histogram(colour="grey") +
            facet_grid(quality ~ .)
  
multiplot(plot1, plot2)

plot3

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

The relationship between alcohol and pH was positive for red wines at a pH level greater than 3.5.  Overall, the relationship between pH and quality did not have a very positive relationship for white wines.  However, for red wines, there was a slight negative relationship between quality and pH for red wines.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
plot1 <- ggplot(data, aes(x=quality)) +
          geom_bar(colour="#333333", fill="#6666FF") +
          ggtitle("Quality Histogram")

plot2 <- ggplot(data, aes(x=alcohol)) +
          geom_bar(colour="#333333", fill="#3399FF") +
          ggtitle("Alcohol Histogram")

plot3 <- ggplot(data, aes(x=sulphates)) +
          geom_bar(colour="#333333", fill="#33FF99") +
          ggtitle("Sulphates Histogram")

plot4 <- ggplot(data, aes(x=pH)) +
          geom_bar(colour="#333333", fill="#CC3333") +
          ggtitle("pH Histogram")

multiplot(plot1, plot2, plot3, plot4)
  
```

### Bar plots for Quality, Alcohol, Sulphates, and pH


### Plot Two
```{r echo=FALSE, Plot_Two}

# box plot -- quality by type
plot1 <- ggplot(data, aes(x=type, y=quality, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for Quality by Wine Type")

# box plot -- pH by type
plot2 <- ggplot(data, aes(x=type, y=pH, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for pH by Wine Type")

multiplot(plot1, plot2)

# correlation matrix

cex.before <- par("cex")
par(cex = 0.7)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(mcor, method="color",
            shade.col=NA, tl.col="black", tl.srt=45, order="FPC",
            col=col(50), addCoef.col="black", addcolorlabel="yes")
par(cex = cex.before)


```

### Correlation Matrix


### Plot Three
```{r echo=FALSE, Plot_Three}
plot1 <- ggplot(data, aes(x=pH, y=quality, color=type)) + geom_point(shape=1) +
          scale_colour_hue(l=75) +
          geom_smooth(method=lm,   # Add linear regression lines
              se=FALSE, fullrange=TRUE) + # extend the regression lines
          ggtitle("Scatter Plot by Wine Type -- pH vs. quality")

plot2 <- ggplot(data, aes(x=pH, y=alcohol, colour=type)) +
            geom_point(alpha=.3) +
            geom_smooth(alpha=.2, size=1, method='loess') +
            ggtitle("Scatter Plot by Wine Type -- pH vs. alcohol")
  
multiplot(plot1, plot2)
```

### Multivariate plots for wine type and pH vs quality/alcohol

------

# Reflection

This was an unbalanced dataset (there were more white wines in the data than red wines) but there were a couple of interesting observations nonetheless.  Quality had fairly low correlation values with all features except for alcohol (correlation = 0.44).  Looking at box plots by type and quality, the majority of red and white wines were rated a 5 or 6, although white wines had more outliers that were rated an 8 or 9. Red wines were also less acidic than white wines in general.
