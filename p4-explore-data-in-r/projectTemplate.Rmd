White and Red Wine Quality by Jennifer Joo
========================================================

For this project, we will look at a dataset of red and white verde wine samples.  The variables in the dataset include:

fixed acidity 
volatile acidity 
citric acid 
residual sugar 
chlorides 
free sulfur dioxide 
total sulfur dioxide 
density 
pH 
sulphates 
alcohol
quality (score between 0 and 10)
type (red, white)

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

# install.packages("ggplot2", dependencies = T) 
# install.packages("knitr", dependencies = T)
# install.packages("dplyr", dependencies = T)
 
library(ggplot2)
library(knitr)
library(dplyr)
library(corrplot)
library(GGally)

```

```{r global_options, include=FALSE}
# prevent warnings from showing in knitted file
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, Load_the_Data}
# data source: http://archive.ics.uci.edu/ml/datasets/Wine+Quality
# my wd: C:/Users/jjoo/Desktop/udacity_data_analyst_projects/p4-explore-data-in-r

# Load the Data
red <- read.csv("winequality-red.csv", sep = ";")
red$type <- 'red'
white <- read.csv("winequality-white.csv", sep = ";")
white$type <- 'white'

data <- rbind(red, white)

```

# Univariate Plots Section

We will begin the analysis by looking at the distribution of each of the above variables individually to see if they're skewed, contain outliers, etc.  We'll also take a quick look at the overall structure of the data and some summary statistics (mean, median, quartiles)

```{r echo=FALSE, Univariate_Plots}
# look at the data frame
str(data)

# look at basic summary statistics for this dataset
summary(data)
```

We have a categorical variable and 12 numeric/integer variables. The single categorical variable is 'type', which indicates whether a datapoint is associated with a red or white wine.

```{r echo=FALSE}
# hist plots for fixed.acidity, volatile.acidity, citric.acid, and residual.sugar
fixed.acidity_hist <- ggplot(data, aes(x=fixed.acidity)) +
          geom_histogram(colour="#2eaaff", fill="#6666FF") +
          ggtitle("Fixed Acidity Histogram") +
          labs(subtitle="slight right skewed distribution")

volatile.acidity_hist <- ggplot(data, aes(x=volatile.acidity)) +
          geom_histogram(colour="#333333", fill="#f4b90c", bins = 70) +
          ggtitle("Volatile Acidity Histogram") +
          labs(subtitle="slight right skewed distribution")

citric.acid_hist <- ggplot(data, aes(x=citric.acid)) +
          geom_histogram(colour="#333333", fill="#ed7aff") +
          ggtitle("Sulphates Histogram") +
          labs(subtitle="slight right skewed distribution with approx. 300 obs having a sulphates value of ~0.5")

residual.sugar_hist <- ggplot(data, aes(x=residual.sugar)) +
          geom_histogram(colour="#333333", fill="#01ba55") +
          ggtitle("Residual Sugar Histogram") +
          labs(subtitle="extremely right skewed distribution")

fixed.acidity_hist; volatile.acidity_hist; citric.acid_hist; residual.sugar_hist

# hist plots for chlorides, free.sulfur.dioxide, total.sulfur.dioxide, and density
chlorides_hist <- ggplot(data, aes(x=chlorides)) +
          geom_histogram(colour="#333333", fill="#b4006d") +
          ggtitle("Chlorides Histogram") +
          labs(subtitle="distributed with two distinct peaks in the data")

free.sulfur.dioxide_hist <- ggplot(data, aes(x=free.sulfur.dioxide)) +
          geom_histogram(colour="#333333", fill="#728f00") +
          ggtitle("Free Sulfur Dioxide Histogram")  +
          labs(subtitle="slightly right skewed distribution")

total.sulfur.dioxide_hist <- ggplot(data, aes(x=total.sulfur.dioxide)) +
          geom_histogram(colour="#333333", fill="#ff4887") +
          ggtitle("Total Sulfur Dioxide Histogram") +
          labs(subtitle="distributed with two distinct peaks in the data")

density_hist <- ggplot(data, aes(x=density)) +
          geom_histogram(colour="#333333", fill="#00b0a3") +
          ggtitle("Density Histogram") +
          labs(subtitle="distribution with many peaks")

chlorides_hist; free.sulfur.dioxide_hist; total.sulfur.dioxide_hist; density_hist


# hist plots for pH, free.sulfur.dioxide, total.sulfur.dioxide, and density
pH_hist <- ggplot(data, aes(x=pH)) +
          geom_histogram(colour="#333333", fill="#a31927") +
          ggtitle("pH Histogram") +
          labs(subtitle="mostly normal distribution")

sulphates_hist <- ggplot(data, aes(x=sulphates)) +
          geom_histogram(colour="#333333", fill="#476697") +
          ggtitle("Sulphates Histogram") +
          labs(subtitle="slightly right skewed distribution")

alcohol_hist <- ggplot(data, aes(x=alcohol)) +
          geom_histogram(colour="#333333", fill="#ffb35c") +
          ggtitle("Alcohol Histogram")+
          labs(subtitle="distribution with many peaks")

quality_hist <- ggplot(data, aes(x=quality)) +
          geom_bar(colour="#333333", fill="#b464c0") +
          ggtitle("Quality Histogram") +
          labs(subtitle="mostly normal distribution with most data points having a quality of 6")

pH_hist; sulphates_hist; alcohol_hist; quality_hist


# histogram for wine type

ggplot(data, aes(x=type)) +
    geom_bar(colour="#333333", fill="#6b7fce") +
    ggtitle("Wine Type Histogram") +
    labs(subtitle="dataset has more white wine samples than red")

```

# Univariate Analysis

### What is the structure of your dataset?

There are 6,497 observations and 13 variables.

### What is/are the main feature(s) of interest in your dataset?

The main features of interest are quality, which is a score between 0 and 10, and type, a created variable that indicates whether the wine is red or white.  However, it is important to note that available quality scores range from 3 to 9.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Without looking further at the data set, I think that pH and alcohol may be important.

### Did you create any new variables from existing variables in the dataset?

Yes, I merge the red wine and white wine datasets and created the variable "type" to indicate which dataset the observations came from.  The possible values are "red" and "white".

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

There are more white wine observations than red wine observations and this may affect the data analysis and any plots to follow but I didn't adjust this distribution, since I didn't want to exclude any data from the analysis.  The distribution for alcohol had many peaks, which I thought was unusual but if I had to hypothesize, I would say that maybe wines were more likely to have certain alcohol levels or this distribution is due to the type of wine (white or red).  The distribution for sulphates also had a sudden peak at around 5.0; this may be due to how the data was collected.


# Bivariate Plots Section

We'll first create a box plot by quality and wine type to see if quality ratings for red and white wines vary drastically.

```{r echo=FALSE, Bivariate_Plots}
# box plot -- quality by type

box_plot1 <- ggplot(data, aes(x=type, y=quality, fill=type)) +
  geom_boxplot() + ggtitle("Box Plot for Quality by Wine Type") +
  labs(subtitle="White Wine has one more outlier than red red
                but otherwise, they have about the same distribution")

# box plot -- pH by type
box_plot2 <- ggplot(data, aes(x=type, y=pH, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for pH by Wine Type")+
          labs(subtitle="Red wine generally has a larger pH than white wine")

box_plot3 <- ggplot(data, aes(x=type, y=alcohol, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for pH by Wine Type")+
          labs(subtitle="White wine generally has a slightly higher alcohol value than red")

print (box_plot1); print (box_plot2); print (box_plot3)

# correlation matrix
# for reference, see:
# https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html
df_corr <- subset( data, select=-c(type) )
mcor <- cor(df_corr)
round(mcor, digits=2)

cex.before <- par("cex")
par(cex = 0.7)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(mcor, method="color",
            shade.col=NA, tl.col="black", tl.srt=45, order="FPC",
            col=col(50), addCoef.col="black", addcolorlabel="yes")
par(cex = cex.before)


```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

In the box plots, quality didn't vary by wine type; the majority of the datapoints had a quality level of 5 or 6, although there white wines had an outlier that had a quality of 9.  However, red wines were generally less acidic (had a higher pH value) than white wines.  White wines also had more outliers in this box plot distribution although there are also more observations for white wines, so this I wouldn't consider this too unusual.


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?

The strongest relationship was between total.sulfur.dioxide and free.sulfur.dioxide which has a correlation of 0.72.  The next strongest was between density and residual.sugar with a correlation of 0.55.


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

# ggpairs -- part 1
# I split the columns up because the graph was getting too big
# I chose the variables that I thought were most interesting
ggpairs(data,
        columns=c('density', 'pH', 'sulphates', 'alcohol', 'quality'), # columns to include in plot
        title='Wine GGpairs plot - selected columns', # title of the plot
        mapping=ggplot2::aes(colour = type)) # how to segment the plot

# ggpairs -- part 2 (look at all columns)
ggpairs(data,
        title='Wine GGpairs plot - all columns', # title of the plot
        mapping=ggplot2::aes(colour = type)) # how to segment the plot

# bar graphs
ggplot(data, aes(x=quality, y=alcohol, fill=type)) +
    geom_bar(stat="identity") +
    ggtitle("Bar Plot for alcohol segmented by quality and wine type")

# scatter plot by wine type
ggplot(data,aes(x=pH, y=alcohol, colour=type)) +
    geom_point(alpha=.3) +
    geom_smooth(alpha=.25, size=1) +
    ggtitle("pH and Alcohol Scatterplot by Wine Type") +
    labs(subtitle = 'For white wines, pH vs. alcohol stays relatively steady,
                but for red wines, alcohol starts to increast at a pH of 3.5')

# scatter grid
ggplot(data, aes(x=pH, y=alcohol, colour = factor(quality))) +
  geom_point() +
  facet_grid(quality ~ type) +
  labs(title = 'pH vs alcohol scatterplot (factored by type and quality)',
      subtitle = 'Correlation between pH and alcohol appears to change
                  by quality level and wine type')

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

The relationship between alcohol and pH was positive for red wines at a pH level greater than 3.5.  Overall, the relationship between pH and quality did not have a very positive relationship for white wines.  However, for red wines, there was a slight negative relationship between quality and pH for red wines.

When I looked at the scatterplot for alcohol and pH segmented by wine type and quality, it appears as though for quality ratings for 3, 8, and 9, there was a somewhat positive relationship between pH and alcohol, alghough this may also be due to the fact that there are fewer observations at these levels.  It's also interesting to note that red wine had zero observations that were rated a 9.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

ggplot(data, aes(x=type, y=pH, fill=type)) +
          geom_boxplot() + ggtitle("Box Plot for pH by Wine Type")+
          labs(subtitle="Red wine generally has a larger pH than white wine") +
    xlab('wine type') + ylab('pH level')
  
```

### Box Plot for pH by Wine Type


### Plot Two
```{r echo=FALSE, Plot_Two}

ggplot(data,aes(x=pH, y=alcohol, colour=type)) +
    geom_point(alpha=.3) +
    geom_smooth(alpha=.25, size=1) +
    ggtitle("pH and Alcohol Scatterplot by Wine Type") +
    labs(subtitle = 'For white wines, pH vs. alcohol stays relatively steady,
                but for red wines, alcohol starts to increast at a pH of 3.5') +
    ylab('alcohol (% ABV)') + xlab('pH level')


```

### pH and Alcohol Scatterplot by Wine Type


### Plot Three
```{r echo=FALSE, Plot_Three}

ggplot(data, aes(x=pH, y=alcohol, colour = factor(quality))) +
  geom_point() +
  facet_grid(quality ~ type) +
  labs(title = 'pH and Alcohol scatterplot (factored by type and quality)',
      subtitle = 'Correlation between pH and alcohol appears to change
                  by quality level and wine type') +
  ylab('alcohol (% ABV)') + xlab('pH level')

```

### pH and Alcohol scatterplot (factored by type and quality)

------

# Reflection
One of the difficult things about this dataset was that there were quite a few columns and I didn't really know how to start looking at it, especially since my knowledge of wine is non-existent. Also, since most wines were rated a 5, 6, or 7, it was somewhat difficult to see what qualities would rate a wine a 9; as we can see in plot three, there are no red wines that were rated a 9 so I couldn't do a comparison there.  Otherwise, I enjoyed analysing this dataset and I think the large number of numerical data made this easier to analyse than say, a dataset with purely categorical values.

For future work, I would also like to attempt to predict a wine's quality rating based on the other provided variables.  Not one variable had a very strong correlation with quality. Alcohol had the highest correlation value with quality at 0.44.